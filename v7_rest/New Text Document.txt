/**
 * Upload a file directly to Salesforce as ContentVersion using multipart/form-data.
 * Supports files up to 2 GB because it uses binary streaming (no base64, no Apex).
 */
async uploadAsContentVersion(file, firstPublishLocationId) {
    const entity = {
        Title: file.name,
        PathOnClient: file.name,
        FirstPublishLocationId: firstPublishLocationId
    };

    const form = new FormData();
    
    // JSON metadata part
    form.append(
        'entity_content',
        new Blob([JSON.stringify(entity)], { type: 'application/json' })
    );

    // Binary file part (IMPORTANT: no base64, no encoding)
    form.append('VersionData', file, file.name);

    // Use relative URL so Salesforce session cookies are automatically included
    const res = await fetch('/services/data/v66.0/sobjects/ContentVersion', {
        method: 'POST',
        body: form
        // DO NOT set Content-Type. FormData sets the multipart boundary for us.
        // DO NOT set Authorization header. Browser cookies authenticate the call.
    });

    if (!res.ok) {
        const errorText = await res.text();
        console.error('Upload failed:', errorText);
        throw new Error(errorText);
    }

    return res.json();   // Contains { id, success, errors } and ContentDocumentId sub-object
}

////////////

// Upload original .MSG file
const msgFile = this.template.querySelector('lightning-input[type="file"]').files[0];
await this.uploadAsContentVersion(msgFile, emailId);

//////////////

Replace your old Apex uploadAttachment loop with this:
==>


if (fileData.attachments && fileData.attachments.length > 0) {
    for (let i = 0; i < fileData.attachments.length; i++) {

        const attMeta = fileData.attachments[i];
        const attObj = msgReader.getAttachment(i);

        if (!attObj || !attObj.content) continue;

        // Convert MSG reader attachment to a Blob-compatible File object
        const fileName = attMeta.fileName || `attachment_${i}`;
        const mimeType = attMeta.contentType || 'application/octet-stream';
        const blob = new Blob([attObj.content], { type: mimeType });
        const file = new File([blob],
